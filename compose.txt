  postgres:
    image: citusdata/citus:11.2
    environment:
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_DB=${DB_NAME}
    ports:
      - "${DB_PORT}:5432"
    volumes:
      - ./data/postgresql/coordinator-data:/var/lib/postgresql/data
    networks:
      - doc_serv_network
    command: >
      postgres
      -c listen_addresses=*
      -c shared_preload_libraries=citus

  # Воркеры (шарды)
  citus-worker-1:
    image: citusdata/citus:11.2
    environment:
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_DB=${DB_NAME}
    volumes:
      - ./data/postgresql/worker-1-data:/var/lib/postgresql/data
    networks:
      - doc_serv_network
    depends_on:
      - postgres
    command: >
      postgres
      -c listen_addresses=*
      -c shared_preload_libraries=citus

  citus-worker-2:
    image: citusdata/citus:11.2
    environment:
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_DB=${DB_NAME}
    volumes:
      - ./data/postgresql/worker-2-data:/var/lib/postgresql/data
    networks:
      - doc_serv_network
    depends_on:
      - postgres
    command: >
      postgres
      -c listen_addresses=*
      -c shared_preload_libraries=citus

  volumes:
      coordinator-data:
      worker-1-data:
      worker-2-data: